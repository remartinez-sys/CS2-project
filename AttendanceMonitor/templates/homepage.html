<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Blocky Engine v2</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; margin:auto; image-rendering: pixelated; background:#87ceeb; }
#mobileControls {
position:fixed;
bottom:10px;
left:50%;
transform:translateX(-50%);
display:flex;
gap:10px;
}
button {
width:60px;
height:60px;
font-size:20px;
}
</style>
</head>
<body>

<canvas id="game" width="1000" height="600"></canvas>

<div id="mobileControls">
<button onclick="mobilePress('left')">◀</button>
<button onclick="mobilePress('jump')">▲</button>
<button onclick="mobilePress('right')">▶</button>
<button onclick="mobilePress('attack')">⚔</button>
<button onclick="mobilePress('mine')">⛏</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.8;
const block = 40;
const worldWidth = 6000;

let keys = {};
let cameraX = 0;
let time = 0;
let rain = false;
let difficulty = 1;

document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

function mobilePress(action){
if(action==="left") keys["a"]=true;
if(action==="right") keys["d"]=true;
if(action==="jump") keys["w"]=true;
if(action==="attack") keys["f"]=true;
if(action==="mine") keys["e"]=true;
setTimeout(()=>{ keys={}; },150);
}

// -------- PLAYERS --------
function createPlayer(x,color){
return {
x:x,y:200,w:30,h:50,
dx:0,dy:0,
color:color,
inventory:{wood:0,stone:0},
health:5,
grounded:false
};
}

let p1=createPlayer(100,"blue");
let p2=createPlayer(200,"red");

// -------- WORLD --------
let ground=[];
let blocks=[];
let enemies=[];
let boss=null;

function generateWorld(){
for(let i=0;i<worldWidth;i+=block){
let height = 400 + Math.sin(i*0.01)*50;
ground.push({x:i,y:height,w:block,h:block});
if(Math.random()<0.1)
blocks.push({x:i,y:height-40,type:"stone",hp:2});
if(Math.random()<0.1)
blocks.push({x:i,y:height-80,type:"wood",hp:1});
}
}

generateWorld();

// -------- ENEMIES --------
function spawnEnemy(x){
enemies.push({
x:x,y:300,w:30,h:30,
dx:2*difficulty,
hp:2*difficulty
});
}

setInterval(()=>spawnEnemy(cameraX+800),4000);

// -------- BOSS --------
function spawnBoss(){
boss={
x:5500,y:200,w:100,h:100,
hp:50,
dx:3
};
}
spawnBoss();

// -------- UPDATE --------
function updatePlayer(p,left,right,jump,attack,mine){

if(keys[left]) p.dx=-4;
else if(keys[right]) p.dx=4;
else p.dx=0;

if(keys[jump] && p.grounded){
p.dy=-15;
p.grounded=false;
}

p.dy+=gravity;
p.x+=p.dx;
p.y+=p.dy;

p.grounded=false;
ground.forEach(g=>{
if(p.x<g.x+g.w &&
p.x+p.w>g.x &&
p.y+p.h<g.y+20 &&
p.y+p.h+p.dy>=g.y){
p.y=g.y-p.h;
p.dy=0;
p.grounded=true;
}
});

// Mining
if(keys[mine]){
blocks.forEach(b=>{
if(Math.abs(p.x-b.x)<50 && Math.abs(p.y-b.y)<50){
b.hp--;
if(b.hp<=0){
p.inventory[b.type]++;
blocks.splice(blocks.indexOf(b),1);
}
}
});
}

// Attack
if(keys[attack]){
enemies.forEach(e=>{
if(Math.abs(p.x-e.x)<60){
e.hp--;
}
});
if(boss && Math.abs(p.x-boss.x)<120){
boss.hp--;
}
}
}

function update(){

time+=0.001;
if(time>1) time=0;
rain = Math.random()<0.002;

difficulty = 1 + Math.floor(time*5);

updatePlayer(p1,"a","d","w","f","e");
updatePlayer(p2,"arrowleft","arrowright","arrowup","l","k");

// Enemies
enemies.forEach(e=>{
e.x+=e.dx;
if(Math.abs(e.x-p1.x)<200) e.dx = p1.x<e.x?-2*difficulty:2*difficulty;
if(e.hp<=0) enemies.splice(enemies.indexOf(e),1);
});

// Boss AI
if(boss){
boss.x+=boss.dx;
if(boss.x<5200 || boss.x>5800) boss.dx*=-1;
if(boss.hp<=0){
alert("YOU DEFEATED THE BOSS!");
boss=null;
}
}

cameraX=p1.x-300;
if(cameraX<0) cameraX=0;
}

// -------- DRAW --------
function drawBlock(x,y,w,h,color){
ctx.fillStyle=color;
ctx.fillRect(x-cameraX,y,w,h);
ctx.strokeRect(x-cameraX,y,w,h);
}

function draw(){

canvas.style.background = time<0.5?"#87ceeb":"#0b0b2b";

ctx.clearRect(0,0,canvas.width,canvas.height);

// Rain
if(rain){
ctx.strokeStyle="white";
for(let i=0;i<100;i++){
ctx.beginPath();
ctx.moveTo(Math.random()*1000,Math.random()*600);
ctx.lineTo(Math.random()*1000,Math.random()*600+10);
ctx.stroke();
}
}

// Ground
ground.forEach(g=>drawBlock(g.x,g.y,g.w,g.h,"green"));

// Blocks
blocks.forEach(b=>{
drawBlock(b.x,b.y,40,40,b.type==="stone"?"gray":"brown");
});

// Enemies
enemies.forEach(e=>drawBlock(e.x,e.y,e.w,e.h,"purple"));

// Boss
if(boss) drawBlock(boss.x,boss.y,boss.w,boss.h,"black");

// Players
drawBlock(p1.x,p1.y,p1.w,p1.h,p1.color);
drawBlock(p2.x,p2.y,p2.w,p2.h,p2.color);

// UI
ctx.fillStyle="black";
ctx.fillText("P1 Wood:"+p1.inventory.wood+" Stone:"+p1.inventory.stone,20,20);
ctx.fillText("P2 Wood:"+p2.inventory.wood+" Stone:"+p2.inventory.stone,20,40);
ctx.fillText("Boss HP:"+(boss?boss.hp:"DEAD"),20,60);
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>






